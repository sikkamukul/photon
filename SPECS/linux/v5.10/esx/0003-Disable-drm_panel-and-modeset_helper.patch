From 12fc42e617f81873f2281a6f11d602a7188f223d Mon Sep 17 00:00:00 2001
From: Alexey Makhalov <amakhalov@vmware.com>
Date: Mon, 10 Jul 2023 21:58:11 +0000
Subject: [PATCH 3/3] Disable drm_panel and modeset_helper

As they are not needed in headless mode.
Signed-off-by: Alexey Makhalov <amakhalov@vmware.com>
---
 drivers/gpu/drm/Makefile | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/Makefile b/drivers/gpu/drm/Makefile
index 4edb3b4..442ac66 100644
--- a/drivers/gpu/drm/Makefile
+++ b/drivers/gpu/drm/Makefile
@@ -27,7 +27,7 @@ drm-$(CPTCFG_DRM_LIB_RANDOM) += lib/drm_random.o
 drm-$(CONFIG_COMPAT) += drm_ioc32.o
 drm-$(CPTCFG_DRM_GEM_CMA_HELPER) += drm_gem_cma_helper.o
 drm-$(CPTCFG_DRM_GEM_SHMEM_HELPER) += drm_gem_shmem_helper.o
-drm-$(CONFIG_DRM_PANEL) += drm_panel.o
+#drm-$(CONFIG_DRM_PANEL) += drm_panel.o
 drm-$(CONFIG_OF) += drm_of.o
 drm-$(CONFIG_PCI) += drm_pci.o
 drm-$(CONFIG_DEBUG_FS) += drm_debugfs.o drm_debugfs_crc.o
@@ -45,14 +45,14 @@ drm_kms_helper-y := drm_bridge_connector.o drm_crtc_helper.o drm_dp_helper.o \
 		drm_dsc.o drm_probe_helper.o \
 		drm_plane_helper.o drm_dp_mst_topology.o drm_atomic_helper.o \
 		drm_kms_helper_common.o drm_dp_dual_mode_helper.o \
-		drm_simple_kms_helper.o drm_modeset_helper.o \
+		drm_simple_kms_helper.o \
 		drm_scdc_helper.o drm_gem_atomic_helper.o \
 		drm_gem_framebuffer_helper.o \
 		drm_atomic_state_helper.o drm_damage_helper.o \
 		drm_format_helper.o drm_self_refresh_helper.o
 
 drm_kms_helper-$(CPTCFG_DRM_PANEL_BRIDGE) += bridge/panel.o
-drm_kms_helper-$(CPTCFG_DRM_FBDEV_EMULATION) += drm_fb_helper.o
+drm_kms_helper-$(CPTCFG_DRM_FBDEV_EMULATION) += drm_modeset_helper.o drm_fb_helper.o
 drm_kms_helper-$(CPTCFG_DRM_KMS_CMA_HELPER) += drm_fb_cma_helper.o
 drm_kms_helper-$(CPTCFG_DRM_DP_AUX_CHARDEV) += drm_dp_aux_dev.o
 drm_kms_helper-$(CPTCFG_DRM_DP_CEC) += drm_dp_cec.o
-- 
2.30.3

